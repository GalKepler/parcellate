# QSIRecon Parcellation Configuration Example
# =============================================
# This file demonstrates how to configure parcellate for processing QSIRecon diffusion outputs.
# See https://GalKepler.github.io/parcellate/ for full documentation.

# Input/Output Paths
# ------------------
# Path to QSIRecon derivatives directory (BIDS-compatible)
input_root = "/mnt/62/Processed_Data/derivatives/qsirecon"

# Output directory for parcellation results
output_dir = "/media/storage/yalab-dev/derivatives/qsiparc"
# Subject/Session Selection
# -------------------------
# Optional: Process specific subjects (default: all discovered)
# subjects = ["CLMC10"]

# Optional: Process specific sessions (default: all discovered)
# sessions = ["ses-01"]

# Processing Options
# ------------------
# Overwrite existing outputs
force = true

# Logging verbosity
log_level = "DEBUG"

# Parallel jobs within subject
n_jobs = 20

# Parallel processes across subjects
n_procs = 20

# Optional: Brain mask (path or builtin: "gm", "wm", "brain")
mask = "gm"

# Optional: Threshold for the mask image
# Voxels with mask values strictly greater than this threshold are included;
# all others are excluded.
# - Default: 0.0 (any non-zero voxel passes — equivalent to a binary mask)
# - Use values in [0, 1] for tissue probability maps, e.g.:
#     0.5 = only voxels with >50% gray-matter probability
#     0.3 = more liberal inclusion, keeps voxels with >30% probability
# Reflected as the "maskthr-<value>" entity in output filenames and recorded
# in the JSON sidecar for provenance.
# mask_threshold = 0.5

# Atlas Definitions
# -----------------
# Define atlases for parcellating diffusion scalar maps
# QSIRecon typically produces maps in MNI152NLin6Asym space

# [[atlases]]
# name = "JHU"
# path = "/atlases/JHU-ICBM-labels-1mm.nii.gz"
# lut = "/atlases/JHU-ICBM-labels-1mm.tsv"
# space = "MNI152NLin6Asym"

[[atlases]]
name = "Schaefer2018N400n7Tian2020S3"
path = "/media/storage/yalab-dev/voxelops/Schaefer2018Tian2020_atlases/atlas-Schaefer2018N400n7Tian2020S3/atlas-Schaefer2018N400n7Tian2020S3_space-MNI152NLin2009cAsym_res-01_dseg.nii.gz"
lut = "/media/storage/yalab-dev/voxelops/Schaefer2018Tian2020_atlases/atlas-Schaefer2018N400n7Tian2020S3/atlas-Schaefer2018N400n7Tian2020S3_dseg.tsv"
space = "MNI152NLin2009cAsym"
resolution = "01"

# Expected Input Structure
# -------------------------
# QSIRecon organizes outputs by workflow:
# qsirecon_derivatives/
# └── derivatives/
#     └── qsirecon-{workflow_name}/
#         └── sub-01/
#             └── ses-01/
#                 └── dwi/
#                     ├── sub-01_ses-01_space-MNI152NLin6Asym_param-FA_dwimap.nii.gz
#                     ├── sub-01_ses-01_space-MNI152NLin6Asym_param-MD_dwimap.nii.gz
#                     ├── sub-01_ses-01_space-MNI152NLin6Asym_param-AD_dwimap.nii.gz
#                     └── sub-01_ses-01_space-MNI152NLin6Asym_param-RD_dwimap.nii.gz

# Expected Output Structure
# --------------------------
# parcellations/
# └── sub-01/
#     └── ses-01/
#         └── dwi/
#             ├── sub-01_ses-01_space-MNI152NLin6Asym_atlas-JHU_param-FA_stats.tsv
#             ├── sub-01_ses-01_space-MNI152NLin6Asym_atlas-JHU_param-MD_stats.tsv
#             ├── sub-01_ses-01_space-MNI152NLin6Asym_atlas-Schaefer400_param-FA_stats.tsv
#             └── ...

# Supported Diffusion Parameters
# -------------------------------
# QSIRecon can generate various scalar maps (param-*):
# - FA: Fractional anisotropy
# - MD: Mean diffusivity
# - AD: Axial diffusivity
# - RD: Radial diffusivity
# - MO: Mode of anisotropy
# - And more depending on reconstruction workflow

# Notes
# -----
# - Scalar maps are automatically discovered in workflow-specific subdirectories
# - Multiple workflows can be processed (all under derivatives/ are scanned)
# - Atlas and scalar maps are matched by 'space' field
# - Use force=true to regenerate existing outputs
# - Multi-session support: each session is processed independently
